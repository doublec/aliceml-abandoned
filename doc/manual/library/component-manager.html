<?php include("macros.php3"); ?>
<?php heading("The COMPONENT_MANAGER signature",
	      "The <TT>COMPONENT_MANAGER</TT> signature") ?>

<?php section("synopsis", "synopsis") ?>

  <PRE>
    structure ComponentManager : COMPONENT_MANAGER
    signature COMPONENT_MANAGER</PRE>

  <P>
    A <EM>component manager</EM> is responsible for loading and linking
    components.  To this aim, every component manager maintains its
    <EM>component table</EM>, which is a mapping from URLs to components.
    All loading, linking, evaluating, and signature matching is performed
    lazily.  For this reason components are initially returned as lazy
    futures, which either get replaced by the component export (on success)
    or failed.  See the
    description of exception <TT><A href="component.html#Failure"
    >Component.Failure</A></TT> to see how these "asynchronous"
    exceptions are handled.
  </P>

  <P>
    URLs given to any of the functions below are first resolved with
    respect to the current working directory and stripped of their query
    and fragment constituents.
  </P>

  <P>
    The structure <TT>ComponentManager</TT> is the root component manager.
  </P>

  <P>
    See also:
    <A href="component.html"><TT>Component</TT></A>,
    <A href="url.html"><TT>Url</TT></A>
  </P>

<?php section("import", "import") ?>

  <PRE>
    import signature COMPONENT_MANAGER from "x-alice:/lib/system/COMPONENT_MANAGER-sig"</PRE>

<?php section("interface", "interface") ?>

  <PRE>
    signature COMPONENT_MANAGER =
    sig
	exception <A href="#Conflict">Conflict</A>

	val <A href="#logStream">logStream</A> : TextIO.outstream option ref

	functor <A href="#Eval-fn">Eval</A>(val component : Component.t
		     val url : <A href="url.html#t">Url.t</A>
		     signature S) : S

	functor <A href="#Link-fn">Link</A>(val url : <A href="url.html#t">Url.t</A>
		     signature S) : S

	functor <A href="#Enter-fn">Enter</A>(val url: <A href="url.html#t">Url.t</A>
		      signature S
		      structure X : S) : any

	val <A href="#load">load</A> : <A href="url.html#t">Url.t</A> -> Component.t
	val <A href="#link">link</A> : <A href="url.html#t">Url.t</A> -> Component.t
	val <A href="#enter">enter</A> : <A href="url.html#t">Url.t</A> * Component.t -> unit
	val <A href="#lookup">lookup</A> : <A href="url.html#t">Url.t</A> -> Component.t option

	val <A href="#start">start</A> : <A href="url.html#t">Url.t</A> -> unit
    end</PRE>

<?php section("description", "description") ?>

  <DL>
    <DT>
      <TT>exception <A name="Conflict">Conflict</A></TT>
    </DT>
    <DD>
      <P>indicates an attempt to enter a component in the component table
	while some component was already registered under that name.</P>
    </DD>

    <DT>
      <TT>val <A name="logStream">logStream</A></TT>
    </DT>
    <DD>
      <P>if set to <TT>SOME</TT> <TT><I>os</I></TT>, the component manager
        will log its activity on stream <TT><I>os</I></TT>, otherwise it
	remains silent. The default can be configured using the
	environment variable <TT>ALICE_TRACE_COMPONENT</TT>, see structure
	<A href="component.html"><TT>Component</TT></A>.</P>
    </DD>

    <DT>
      <TT><A name="Eval-fn">Eval</A>(val component = <I>comp</I>
	val url = <I>url</I>
	signature S = <I>S</I>)</TT>
    </DT>
    <DD>
      <P>evaluates <TT><I>comp</I></TT>, rooted at <TT><I>url</I></TT>,
	in the context of the component table managed by this component
	manager, and returns the computed structure.  Raises <TT><A
	href="component.html#Mismatch">Component.Mismatch</A></TT> if
	the computed structure does not match&nbsp;<TT><I>S</I></TT>,
	<EM>after</EM> evaluating the declarations contained in
	<TT><I>comp</I></TT>.  Note that no entry for <TT><I>url</I></TT>
	is created in the component table, but entries may be created for
	components imported (directly or indirectly) by <TT><I>comp</I></TT>.
	Relative import URLs in <TT><I>comp</I></TT> are resolved using
	<TT><I>url</I></TT> as a base url, which should be absolute.</P>
    </DD>

    <DT>
      <TT><A name="Link-fn">Link</A>(val url = <I>url</I>
	signature S = <I>S</I>)</TT>
    </DT>
    <DD>
      <P>returns a new by-need future that, when triggered, causes the
	component from <TT><I>url</I></TT> to be linked and evaluated and
	its signature to be matched against&nbsp;<TT><I>S</I></TT>.  The
	future is then bound to the structure computed by the component.
	If the component table has no entry for <TT><I>url</I></TT> yet, a
	new entry is created immediately.</P>
    </DD>

    <DT>
      <TT><A name="Enter-fn">Enter</A>(val url = <I>url</I>
	signature S = <I>S</I>
	structure X = <I>X</I>)</TT>
    </DT>
    <DD>
      <P>enters an evaluated component with export structure&nbsp;<TT><I
	>X</I></TT> of signature&nbsp;<TT><I>S</I></TT> into the component
	table, under name <TT><I>url</I></TT>.  Raises <TT><A href="#Conflict"
	>Conflict</A></TT> if the component table already had an entry for
	<TT><I>url</I></TT>.</P>
    </DD>

    <DT>
      <TT><A name="link">link</A> <I>url</I></TT>
    </DT>
    <DD>
      <P>returns a new by-need future that, when triggered, causes the
	component from <TT><I>url</I></TT> to be linked and evaluated.
	The future is then bound to the component.  If the component table
	has no entry for <TT><I>url</I></TT> yet, a new entry is created
	immediately.</P>
    </DD>

    <DT>
      <TT><A name="load">load</A> <I>url</I></TT>
    </DT>
    <DD>
      <P>localizes <TT><I>url</I></TT> and loads a first-class component
        from the file found, without linking or evaluating it.
	Raises <TT><A href="io.html">IO.Io</A></TT> if resolving, loading
	or unpickling fails.</P>
    </DD>

    <DT>
      <TT><A name="enter">enter</A> (<I>url</I>, <I>comp</I>)</TT>
    </DT>
    <DD>
      <P>enters <TT><I>comp</I></TT> into the component table, under name
	<TT><I>url</I></TT>.  Raises <TT><A href="#Conflict">Conflict</A></TT>
	if the component table already had an entry for <TT><I>url</I
	></TT>.</P>
    </DD>

    <DT>
      <TT><A name="lookup">lookup</A> <I>url</I></TT>
    </DT>
    <DD>
      <P>returns <TT>SOME <I>comp</I></TT>, if the component table has
	an entry mapping <TT><I>url</I></TT> to <TT><I>comp</I></TT>, or
	<TT>NONE</TT> otherwise.</P>
    </DD>

    <DT>
      <TT><A name="start">start</A> <I>url</I></TT>
    </DT>
    <DD>
      <P>links and evaluates the component at <TT><I>url</I></TT> eagerly.
	Raises <TT><A href="component.html#Failure">Component.Failure</A></TT>
	if this fails.</P>
    </DD>
  </DL>

<?php footing() ?>
